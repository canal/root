Ext.namespace("uradix.fileupload.ux.panel.AttachFileGridPanel");uradix.fileupload.ux.panel.AttachFileGridPanel=Ext.extend(Ext.grid.GridPanel,{constructor:function(a){var b={cls:"idxm-grid",frame:false,height:125,width:390,autoScroll:true,enableColumnMove:false,enableColumnResize:false,hidden:true,colModel:new Ext.grid.ColumnModel({columns:[{id:"addedOnDate",header:"Added On",sortable:true,dataIndex:"addedOnDate"},{header:"Name",sortable:true,dataIndex:"fileName"},{header:"Added By",sortable:true,dataIndex:"addedByUser"},{header:"Size",sortable:true,dataIndex:"fileSize"}],defaults:{sortable:true,menuDisabled:true}}),stripeRows:true,viewConfig:{rowHeight:25,scrollOffset:0,autoFill:true,forceFit:true},store:{reader:new Ext.data.JsonReader({root:"searchList",fields:["addedOnDate","fileName","addedByUser","fileSize"]}),data:{searchList:[]}},listeners:{rowdblclick:function(d,c,f){var h=d.getStore().getAt(c)}}};Ext.apply(this,a,b);uradix.fileupload.ux.panel.AttachFileGridPanel.superclass.constructor.call(this,a)}});Ext.reg("uradix.fileupload.ux.panel.AttachFileGridPanel",uradix.fileupload.ux.panel.AttachFileGridPanel);Ext.namespace("uradix.fileupload.windows.AttachFileWindow");uradix.fileupload.windows.AttachFileWindow=Ext.extend(Object,{UPLOADFORM:null,FILEFIELDID:null,UPLOADFORMHANDLER:null,DEFAULTSRESULTPANEL:null,ATTACHFILEGRIDPANEL:null,ATTACHFILESTORE:null,ATTACHFILECOLUMMODEL:null,UPLOADCALLBACK:null,UPLOADWINDOW:null,UPLOADWINDOWCALLBACK:null,CONN:new Ext.data.Connection(),CASEURL:undefined,ADDEDBY:undefined,ONADDCALLBACK:null,ONCLOSECALLBACK:null,CASENUMBER:null,SHOWWINDOW:function(a){this.CASENUMBER=a.caseNumber;this.UPLOADWINDOW.setTitle("Upload File(s) For Service Case #: "+a.caseNumber);this.UPLOADWINDOW.show();var b=this.ATTACHFILEGRIDPANEL.getStore();b.filter("caseNumber",a.caseNumber);var c=b.getCount();if(c){this.DEFAULTSRESULTPANEL.hide();this.ATTACHFILEGRIDPANEL.show()}else{this.DEFAULTSRESULTPANEL.show()}this.UPLOADFORM.getForm().reset()},constructor:function(config){var thisObj=this;thisObj.FILEFIELDID=((config.filefieldid)&&(config.filefieldid!=undefined))?config.filefieldid:"uradix-fileupload-fileuploadfield";thisObj.UPLOADFORMHANDLER=config.uploadformhandler;thisObj.CASEURL=((config.caseurl)&&(config.caseurl!=undefined))?config.caseurl:undefined;thisObj.ADDEDBY=((config.addedByName)&&(config.addedByName!=undefined))?config.addedByName:undefined;thisObj.ONADDCALLBACK=((config.onAddCallBackFunction)&&(config.onAddCallBackFunction!=undefined))?config.onAddCallBackFunction:undefined;thisObj.ONCLOSECALLBACK=((config.onCloseCallBackFunction)&&(config.onCloseCallBackFunction!=undefined))?config.onCloseCallBackFunction:undefined;this.UPLOADFORM=new uRadix.form.FormPanel({frame:true,labelWidth:50,fileUpload:true,defaults:{anchor:"95%",allowBlank:false},items:[{xtype:"hidden",id:config.userid,name:config.userid,value:config.useridvalue},{xtype:"hidden",id:config.appid,name:config.appid,value:config.appidvalue},{xtype:"hidden",id:config.tokenlistid,name:config.tokenlistid,value:config.tokenlistidvalue},{xtype:"hidden",id:config.credentialuserid,name:config.credentialuserid,value:config.credentialuseridvalue},{xtype:"hidden",id:config.filetypeid,name:config.filetypeid,value:config.filetypeidvalue},{xtype:"hidden",id:config.credentialsamltokenid,name:config.credentialsamltokenid,value:config.credentialsamltokenidvalue},{xtype:"fileuploadfield",emptyText:"Select a file",width:200,fieldLabel:"File",id:thisObj.FILEFIELDID,name:thisObj.FILEFIELDID,msgTarget:"under",buttonText:"",buttonCfg:{iconCls:"upload-icon"}}],buttons:[{text:"Upload",handler:thisObj.UPLOADFORMHANDLER}]});var UPLOADFORM=this.UPLOADFORM;this.DEFAULTSRESULTPANEL=new Ext.Panel({border:false,html:"<center><BR><BR><BR>Please Attach Files</center>"});this.ATTACHFILEGRIDPANEL=new uradix.fileupload.ux.panel.AttachFileGridPanel({});this.ATTACHFILESTORE=new Ext.data.Store({reader:new Ext.data.JsonReader({root:"searchList",fields:["caseNumber","fileUUID","addedOnDate","fileName","addedByUser","fileSize"]})});this.ATTACHFILECOLUMMODEL=new Ext.grid.ColumnModel({columns:[{header:"Added On",sortable:true,dataIndex:"addedOnDate"},{header:"Name",sortable:true,dataIndex:"fileName"},{header:"Added By",sortable:true,dataIndex:"addedByUser"},{header:"Size",sortable:true,dataIndex:"fileSize",renderer:function(val){return Ext.util.Format.fileSize(val)}}],defaults:{sortable:true,menuDisabled:true}});this.UPLOADWINDOW=new Ext.Window({width:400,height:280,modal:true,autoScroll:true,resizable:false,layout:"border",closable:false,title:"Upload File(s)",items:[{region:"north",height:100,split:true,border:false,bodyBorder:false,layout:"fit",items:[thisObj.UPLOADFORM]},{region:"center",border:false,bodyBorder:false,layout:"fit",items:[thisObj.DEFAULTSRESULTPANEL,thisObj.ATTACHFILEGRIDPANEL]}],buttons:[{text:"OK",handler:function(){if(thisObj.ONCLOSECALLBACK){eval(thisObj.ONCLOSECALLBACK+"()")}thisObj.UPLOADWINDOW.hide()}}]});var UPLOADWINDOW=this.UPLOADWINDOW;this.UPLOADCALLBACK=function(response){thisObj.ATTACHFILEGRIDPANEL.reconfigure(thisObj.ATTACHFILESTORE,thisObj.ATTACHFILECOLUMMODEL);if(response.session){if(response.status.success){thisObj.DEFAULTSRESULTPANEL.hide();var gridStore=thisObj.ATTACHFILEGRIDPANEL.getStore();var newDate=new Date();newDate=newDate.format("m/d/Y");var fileRecord=new Ext.data.Record.create([{name:"caseNumber"},,{name:"addedOnDate"},{name:"fileName"},{name:"addedByUser"},{name:"fileSize"},{name:"fileUUID"}]);var fileDataRecord=new fileRecord({caseNumber:thisObj.CASENUMBER,addedOnDate:newDate,fileName:response.data.fileName,addedByUser:thisObj.ADDEDBY,fileSize:response.data.contentLength,fileUUID:response.data.fileUUID});if(thisObj.ONADDCALLBACK){eval(thisObj.ONADDCALLBACK+"(fileDataRecord)")}gridStore.add(fileDataRecord);thisObj.ATTACHFILEGRIDPANEL.show();try{var selectionModel=thisObj.ATTACHFILEGRIDPANEL.getSelectionModel();selectionModel.selectLastRow();thisObj.ATTACHFILEGRIDPANEL.getView().getRow(gridStore.getCount()-1).scrollIntoView()}catch(e){}thisObj.CONN.request({url:thisObj.CASEURL,method:"POST",params:{caseNumber:thisObj.CASENUMBER,fileUUID:response.data.fileUUID,fileName:response.data.fileName,fileSize:response.data.contentLength,fileTypeId:response.data.fileTypeId},success:function(form,action){},failure:function(){alert("Failed to relate File "+response.data.fileName+"to this Case")}});thisObj.UPLOADFORM.getForm().reset()}else{var fileField=Ext.getCmp(thisObj.FILEFIELDID);fileField.markInvalid(response.messages.inputFields[0].title,response.messages.inputFields[0].description)}}else{alert("Session is False")}}}});Ext.reg("uradix.fileupload.windows.AttachFileWindow",uradix.fileupload.windows.AttachFileWindow);