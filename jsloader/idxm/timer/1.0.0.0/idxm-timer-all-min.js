Ext.override(Ext.data.Connection,{handleResponse:function(a){var c=JSLoader.getEnv("IDXM_TIMER_OBJECT");if(!Ext.isEmpty(c)){c.stopTimers();c.startTimers({main:true})}this.transId=false;var b=a.argument.options;a.argument=b?b.argument:null;this.fireEvent("requestcomplete",this,a,b);if(b.success){b.success.call(b.scope,a,b)}if(b.callback){b.callback.call(b.scope,b,true,a)}},handleFailure:function(a,d){var c=JSLoader.getEnv("IDXM_TIMER_OBJECT");if(!Ext.isEmpty(c)){c.stopTimers();c.startTimers({main:true})}if(a.isTimeout){Ext.Msg.show({title:"Timeout",msg:'<div style="padding-top:7px;">Sorry, your request has timed out. Please contact support if the problem persists.</div>',icon:Ext.MessageBox.WARNING})}this.transId=false;var b=a.argument.options;a.argument=b?b.argument:null;this.fireEvent("requestexception",this,a,b,d);if(b.failure){b.failure.call(b.scope,a,b)}if(b.callback){b.callback.call(b.scope,b,false,a)}}});Ext.namespace("idxm.timer.PortletRefresherArrayController");idxm.timer.PortletRefresherArrayController=Ext.extend(Object,{URLARRAY:new Array(),BASECONFIG:{},constructor:function(a){if(!Ext.isEmpty(a)){this.BASECONFIG=a}},addPortletUrlToArray:function(a){if(!Ext.isEmpty(a)){this.URLARRAY[this.URLARRAY.length]=a}},refreshPortletUrl:function(){if(!Ext.isEmpty(this.URLARRAY)){var c=true;for(i=0;i<this.URLARRAY.length;i++){if(!Ext.isEmpty(this.URLARRAY[i])){var a=this.URLARRAY[i];var b=new Ext.data.Connection();b.request({url:a,method:"POST",success:function(d,e){},failure:function(){alert("Please Login again.  We were unable to renew your session");c=false;thisObject.killSession({})}})}}return c}}});idxm.timer.PortletRefresherArrayController=new idxm.timer.PortletRefresherArrayController({});Ext.namespace("idxm.timer.TimerController");idxm.timer.TimerController=Ext.extend(Object,{PREFIX_ID:"idxmTimer",DEFAULT_TIMEOUT_MAIN:1440000,DEFAULT_TIMEOUT_WARN:300000,BASECONFIG:{},TIMER_TASK_OBJ:undefined,TIMER_TASK_INNER_OBJ:undefined,TIMEOUT_WINDOW:undefined,URL_KILL_SESSION:undefined,URL_PING_SESSION:undefined,constructor:function(a){if(!Ext.isEmpty(a)){this.BASECONFIG=a}this.URL_CHECK_SESSION_ALIVE=a.sessionAliveLink;this.URL_KILL_SESSION=a.killSessionUrl;this.URL_PING_SESSION=a.pingSessionUrl},startTimers:function(a){if(a.main){if(Ext.isEmpty(this.TIMER_TASK_OBJ)){this.TIMER_TASK_OBJ=new Ext.util.DelayedTask(function(){this.showTimeoutWindow()},this)}this.TIMER_TASK_OBJ.delay((Ext.isEmpty(this.BASECONFIG.timeOutInterval)==false)?this.BASECONFIG.timeOutInterval:this.DEFAULT_TIMEOUT_MAIN)}if(a.inner){if(Ext.isEmpty(this.TIMER_TASK_INNER_OBJ)){this.TIMER_TASK_INNER_OBJ=new Ext.util.DelayedTask(function(){this.checkSessionAlive({ping:false,o:a})},this)}this.TIMER_TASK_INNER_OBJ.delay((Ext.isEmpty(this.BASECONFIG.timeOutWarnInterval)==false)?this.BASECONFIG.timeOutWarnInterval:this.DEFAULT_TIMEOUT_WARN)}},stopTimers:function(){if(!Ext.isEmpty(this.TIMER_TASK_OBJ)){this.TIMER_TASK_OBJ.cancel()}if(!Ext.isEmpty(this.TIMER_TASK_INNER_OBJ)){this.TIMER_TASK_INNER_OBJ.cancel()}},showTimeoutWindow:function(){this.TIMEOUT_WINDOW=new idxm.timer.ux.window.TimerWindow();this.TIMEOUT_WINDOW.show();this.TIMEOUT_WINDOW.on("killSession",function(a){this.killSession(a)},this);this.TIMEOUT_WINDOW.on("pingSession",function(a){this.pingSession(a)},this);this.startTimers({inner:true});return},checkSessionAlive:function(a){thisObject=this;Ext.Ajax.request({url:this.URL_CHECK_SESSION_ALIVE,success:function(b){var d=uRadixUtilities.jsonDecode(b.responseText);if((!Ext.isEmpty(d.status))&&(!Ext.isEmpty(d.status.sessionAlive))&&(d.status.sessionAlive)){thisObject.TIMEOUT_WINDOW.close();thisObject.stopTimers();var c=idxm.timer.PortletRefresherArrayController.refreshPortletUrl(thisObject);if(!c){window.location=window.location}if(a.ping){Ext.Ajax.request({url:thisObject.URL_PING_SESSION,success:Ext.emptyFn,failure:Ext.emptyFn})}thisObject.startTimers({main:true})}else{if(a.ping){alert("We are Sorry your Session has time out.  Please login again.");thisObject.killSession(a.o)}else{thisObject.killSession(a.o)}}},failure:function(){Ext.Msg.alert("Status","Check Session Alive Ajax Call Failed.");thisObject.killSession(a.o)}})},killSession:function(a){this.TIMEOUT_WINDOW.close();this.stopTimers();uRadixRedirectHandler.redirect(this.URL_KILL_SESSION)},pingSession:function(a){this.checkSessionAlive({ping:true,o:a})}});Ext.namespace("idxm.timer.ux.window.TimerWindow");idxm.timer.ux.window.TimerWindow=Ext.extend(Ext.Window,{constructor:function(a){var b={width:600,height:225,modal:true,autoScroll:true,closable:false,resizable:false,layout:"fit",plain:true,items:[{xtype:"panel",border:false,bodyBorder:false,hideBorders:true,style:"background-color:#FFFFFF; background:#FFFFFF; padding:5px;",items:[{xtype:"idxmStatusBox",status:"warning-noicon",statusText:"You are about to be logged out"},{xtype:"panel",style:"padding-left:15px;",autoScroll:true,html:"<span class='portal-text-large-bold'><BR>You have been idle and will be logged off in five minutes.<BR><BR>You will lose any information that has not been submitted.<BR><BR>Do you want to remain logged in? </span>"}],buttons:[{ctCls:"support-portal-btn-cancel",text:"LOG OUT",scope:this,handler:function(){this.fireEvent("killSession",this)}},{ctCls:"support-portal-btn",text:"REMAIN LOGGED IN",scope:this,handler:function(){this.fireEvent("pingSession",this)}}]}]};var c={};Ext.apply(c,a);Ext.applyIf(c,b);idxm.timer.ux.window.TimerWindow.superclass.constructor.call(this,c);this.addEvents("killSession","pingSession")}});Ext.reg("idxm.timer.ux.window.TimerWindow",idxm.timer.ux.window.TimerWindow);